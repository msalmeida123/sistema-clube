version: '3.8'

# ==============================================
# SISTEMA CLUBE - Stack para Portainer
# ==============================================
# 
# Variáveis de ambiente necessárias:
# - SUPABASE_URL: URL do seu projeto Supabase
# - SUPABASE_ANON_KEY: Chave anônima do Supabase
#
# Exemplo:
# SUPABASE_URL=https://xxxxx.supabase.co
# SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
#
# ==============================================

services:
  sistema-clube:
    image: ghcr.io/msalmeida123/sistema-clube:latest
    # Ou use a imagem local:
    # build:
    #   context: ./web
    #   dockerfile: Dockerfile
    container_name: sistema-clube
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_SUPABASE_URL=${SUPABASE_URL:-https://fkjjjpgxkjhqkhmdpmzk.supabase.co}
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
    networks:
      - sistema-clube-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.sistema-clube.rule=Host(`clube.seudominio.com`)"
      - "traefik.http.routers.sistema-clube.entrypoints=websecure"
      - "traefik.http.routers.sistema-clube.tls.certresolver=letsencrypt"
      - "traefik.http.services.sistema-clube.loadbalancer.server.port=3000"

networks:
  sistema-clube-network:
    driver: bridge
